<VirtualHost *:80>
    ServerName localhost
    DocumentRoot /var/www/html/everleigh/out

    <Directory /var/www/html/everleigh/out>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        # For SPA routing, redirect all requests to index.html
        FallbackResource /index.html
    </Directory>

    ProxyPreserveHost On

    # API routes - updated port
    ProxyPass /api http://localhost:40693/api
    ProxyPassReverse /api http://localhost:40693/api

    # n8n routes - note the trailing slash in proxy pass target
    ProxyPass /n8n/ http://localhost:5678/
    ProxyPassReverse /n8n/ http://localhost:5678/
    
    # LiveKit proxying
    ProxyPass /livekit http://localhost:7880
    ProxyPassReverse /livekit http://localhost:7880
    
    # Enable WebSocket proxying
    RewriteEngine On
    
    # WebSockets for n8n
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /n8n/(.*) ws://localhost:5678/$1 [P,L]
    
    # WebSockets for LiveKit
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /livekit/(.*) ws://localhost:7880/$1 [P,L]

    # MongoDB admin (if needed)
    #ProxyPass /mongo http://localhost:27017
    #ProxyPassReverse /mongo http://localhost:27017

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost> 